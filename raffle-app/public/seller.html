<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard - Raffle App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .seller-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .seller-name {
            color: #667eea;
            font-weight: 600;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #333;
            font-size: 32px;
            font-weight: bold;
        }

        .stat-value.currency::before {
            content: '$';
            font-size: 24px;
        }

        .main-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            color: #333;
            font-size: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .tickets-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .tickets-table th,
        .tickets-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .tickets-table th {
            background: #f9fafb;
            color: #666;
            font-weight: 600;
            font-size: 14px;
        }

        .tickets-table td {
            color: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-available {
            background: #d1fae5;
            color: #065f46;
        }

        .status-sold {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-reserved {
            background: #fef3c7;
            color: #92400e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #333;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-cancel {
            background: #6b7280;
            color: white;
        }

        .btn-cancel:hover {
            background: #4b5563;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tickets-table {
                font-size: 12px;
            }

            .tickets-table th,
            .tickets-table td {
                padding: 8px;
            }
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-controls select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            font-size: 14px;
        }

        .ticket-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .scanner-section,
        .concern-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .scanner-section h2,
        .concern-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .scanner-section p,
        .concern-section p {
            color: #666;
            margin-bottom: 15px;
        }

        #scannerContainer {
            margin-top: 15px;
        }

        #scannerVideo {
            border-radius: 8px;
            max-width: 100%;
        }

        #scanResult {
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }

        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
        }

        .manual-entry-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .manual-entry-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .manual-entry-section p {
            color: #666;
            margin-bottom: 15px;
        }

        #manualEntryResult {
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéüÔ∏è Seller Dashboard</h1>
            <div class="seller-info">
                <span class="seller-name" id="sellerName">Loading...</span>
                <select id="languageSelector" onchange="changeLanguage()" style="padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; cursor: pointer; background: white;">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="ht">üá≠üáπ Krey√≤l Ayisyen</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                </select>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Tickets Sold</div>
                <div class="stat-value" id="ticketsSold">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Revenue</div>
                <div class="stat-value currency" id="totalRevenue">0</div>
            </div>
        </div>

        <!-- Barcode Scanner Section -->
        <div class="scanner-section">
            <h2>üì∑ Scan Ticket</h2>
            <p>Use your camera to scan ticket barcodes</p>
            <button class="btn btn-primary" onclick="openBarcodeScanner()">Open Camera Scanner</button>
            <div id="scannerContainer" style="display: none;">
                <video id="scannerVideo" width="100%" autoplay style="display: none;"></video>
                <canvas id="scannerCanvas" style="display: none;"></canvas>
                <button class="btn btn-cancel" onclick="closeBarcodeScanner()">Close Scanner</button>
            </div>
            <div id="scanResult" style="margin-top: 15px;"></div>
        </div>

        <!-- Manual Ticket Entry Section -->
        <div class="manual-entry-section">
            <h2>‚úçÔ∏è Manual Ticket Entry</h2>
            <p>Enter ticket number manually if scanner doesn't work</p>
            <form id="manualTicketForm" style="display: flex; gap: 10px; align-items: flex-end;">
                <div style="flex: 1;">
                    <label for="manualTicketNumber" style="display: block; margin-bottom: 5px; color: #666; font-size: 14px;">Ticket Number</label>
                    <input 
                        type="text" 
                        id="manualTicketNumber" 
                        placeholder="Enter ticket number" 
                        required 
                        style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px;"
                    >
                </div>
                <button type="submit" class="btn btn-success">
                    ‚úÖ Register Sale
                </button>
            </form>
            <div id="manualEntryResult" style="margin-top: 15px;"></div>
        </div>

        <!-- Report Concern Section -->
        <div class="concern-section">
            <h2>‚ö†Ô∏è Report a Concern</h2>
            <p>Report any issues you encounter</p>
            <button class="btn btn-warning" onclick="openConcernModal()">Report an Issue</button>
        </div>
    </div>

    <!-- Concern Modal -->
    <div class="modal" id="concernModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Report a Concern</h3>
            </div>
            <form id="concernForm">
                <div class="form-group">
                    <label>Issue Type</label>
                    <select id="issueType" required>
                        <option value="">Select issue type...</option>
                        <option value="damaged_ticket">Damaged/Invalid Ticket</option>
                        <option value="scanner_issue">Scanner Not Working</option>
                        <option value="duplicate_barcode">Duplicate Barcode</option>
                        <option value="customer_complaint">Customer Complaint</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ticket Number (if applicable)</label>
                    <input type="text" id="concernTicketNumber" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="concernDescription" required rows="4" placeholder="Describe the issue..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeConcernModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Report</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentSeller = null;

        // Translation data
        const translations = {
            en: {
                title: "Seller Dashboard",
                sellerName: "Seller",
                logout: "Logout",
                ticketsSold: "Tickets Sold",
                totalRevenue: "Total Revenue",
                scanTicket: "Scan Ticket",
                scanDescription: "Use your camera to scan ticket barcodes",
                openScanner: "Open Camera Scanner",
                closeScanner: "Close Scanner",
                manualEntry: "Manual Ticket Entry",
                manualDescription: "Enter ticket number manually if scanner doesn't work",
                ticketNumber: "Ticket Number",
                registerSale: "Register Sale",
                reportConcern: "Report a Concern",
                reportDescription: "Report any issues you encounter",
                reportIssue: "Report an Issue",
                concernTitle: "Report a Concern",
                issueType: "Issue Type",
                selectIssue: "Select issue type...",
                damagedTicket: "Damaged/Invalid Ticket",
                scannerIssue: "Scanner Not Working",
                duplicateBarcode: "Duplicate Barcode",
                customerComplaint: "Customer Complaint",
                other: "Other",
                ticketNumberOptional: "Ticket Number (if applicable)",
                optional: "Optional",
                description: "Description",
                descriptionPlaceholder: "Describe the issue...",
                cancel: "Cancel",
                submitReport: "Submit Report",
                processing: "Processing...",
                ticketSoldSuccess: "sold successfully!",
                errorPrefix: "Error:",
                concernSuccess: "Concern reported successfully! Admin will review it.",
                enterTicket: "Please enter a ticket number",
                cameraError: "Unable to access camera. Please check permissions.",
                enterManually: "Enter ticket number manually",
                enterBarcode: "Enter barcode manually (scanner integration in progress):"
            },
            ht: {
                title: "Tablo Vand√®",
                sellerName: "Vand√®",
                logout: "Dekonekte",
                ticketsSold: "Tik√® Vann",
                totalRevenue: "Total Lajan",
                scanTicket: "Eskane Tik√®",
                scanDescription: "S√®vi ak kamera ou pou eskane k√≤d tik√® yo",
                openScanner: "Louvri Kamera",
                closeScanner: "F√®men Kamera",
                manualEntry: "Antre Tik√® Many√®lman",
                manualDescription: "Antre nimewo tik√® a many√®lman si eskan√® a pa mache",
                ticketNumber: "Nimewo Tik√®",
                registerSale: "Anrejistre Vant",
                reportConcern: "Rap√≤te yon Pwobl√®m",
                reportDescription: "Rap√≤te nenp√≤t pwobl√®m ou rankontre",
                reportIssue: "Rap√≤te yon Pwobl√®m",
                concernTitle: "Rap√≤te yon Pwobl√®m",
                issueType: "Kalite Pwobl√®m",
                selectIssue: "Chwazi kalite pwobl√®m...",
                damagedTicket: "Tik√® Domaje/Envalid",
                scannerIssue: "Eskan√® Pa Mache",
                duplicateBarcode: "K√≤d Duplike",
                customerComplaint: "Plent Kliyan",
                other: "L√≤t",
                ticketNumberOptional: "Nimewo Tik√® (si posib)",
                optional: "Opsyon√®l",
                description: "Deskripsyon",
                descriptionPlaceholder: "Dekri pwobl√®m nan...",
                cancel: "Anile",
                submitReport: "Soum√®t Rap√≤",
                processing: "K ap trete...",
                ticketSoldSuccess: "vann av√®k siks√®!",
                errorPrefix: "Er√®:",
                concernSuccess: "Pwobl√®m rap√≤te av√®k siks√®! Admin ap gade l.",
                enterTicket: "Tanpri antre yon nimewo tik√®",
                cameraError: "Pa ka aksede kamera. Tanpri verifye p√®misyon yo.",
                enterManually: "Antre nimewo tik√® many√®lman",
                enterBarcode: "Antre k√≤d many√®lman (entegrasyon eskan√® an pwogr√®):"
            },
            fr: {
                title: "Tableau de Bord Vendeur",
                sellerName: "Vendeur",
                logout: "D√©connexion",
                ticketsSold: "Billets Vendus",
                totalRevenue: "Revenu Total",
                scanTicket: "Scanner Billet",
                scanDescription: "Utilisez votre cam√©ra pour scanner les codes-barres des billets",
                openScanner: "Ouvrir Scanner",
                closeScanner: "Fermer Scanner",
                manualEntry: "Saisie Manuelle de Billet",
                manualDescription: "Entrez le num√©ro de billet manuellement si le scanner ne fonctionne pas",
                ticketNumber: "Num√©ro de Billet",
                registerSale: "Enregistrer Vente",
                reportConcern: "Signaler un Probl√®me",
                reportDescription: "Signalez tout probl√®me rencontr√©",
                reportIssue: "Signaler un Probl√®me",
                concernTitle: "Signaler un Probl√®me",
                issueType: "Type de Probl√®me",
                selectIssue: "S√©lectionner le type de probl√®me...",
                damagedTicket: "Billet Endommag√©/Invalide",
                scannerIssue: "Scanner Ne Fonctionne Pas",
                duplicateBarcode: "Code-Barres Dupliqu√©",
                customerComplaint: "Plainte Client",
                other: "Autre",
                ticketNumberOptional: "Num√©ro de Billet (si applicable)",
                optional: "Optionnel",
                description: "Description",
                descriptionPlaceholder: "D√©crivez le probl√®me...",
                cancel: "Annuler",
                submitReport: "Soumettre Rapport",
                processing: "Traitement...",
                ticketSoldSuccess: "vendu avec succ√®s!",
                errorPrefix: "Erreur:",
                concernSuccess: "Probl√®me signal√© avec succ√®s! L'admin le v√©rifiera.",
                enterTicket: "Veuillez entrer un num√©ro de billet",
                cameraError: "Impossible d'acc√©der √† la cam√©ra. Veuillez v√©rifier les autorisations.",
                enterManually: "Entrer le num√©ro de billet manuellement",
                enterBarcode: "Entrez le code-barres manuellement (int√©gration du scanner en cours):"
            }
        };

        // Get saved language or default to English
        let currentLanguage = localStorage.getItem('sellerLanguage') || 'en';

        // Change language function
        function changeLanguage() {
            const selector = document.getElementById('languageSelector');
            currentLanguage = selector.value;
            localStorage.setItem('sellerLanguage', currentLanguage);
            applyTranslations();
        }

        // Apply translations to page
        function applyTranslations() {
            const t = translations[currentLanguage];
            
            // Header
            document.querySelector('.header h1').textContent = 'üéüÔ∏è ' + t.title;
            document.querySelector('.logout-btn').textContent = t.logout;
            
            // Stats
            document.querySelectorAll('.stat-label')[0].textContent = t.ticketsSold;
            document.querySelectorAll('.stat-label')[1].textContent = t.totalRevenue;
            
            // Scanner section
            document.querySelector('.scanner-section h2').textContent = 'üì∑ ' + t.scanTicket;
            document.querySelector('.scanner-section p').textContent = t.scanDescription;
            document.querySelector('.scanner-section .btn-primary').textContent = t.openScanner;
            document.querySelector('#scannerContainer .btn-cancel').textContent = t.closeScanner;
            
            // Manual entry section
            document.querySelector('.manual-entry-section h2').textContent = '‚úçÔ∏è ' + t.manualEntry;
            document.querySelector('.manual-entry-section p').textContent = t.manualDescription;
            document.querySelector('label[for="manualTicketNumber"]').textContent = t.ticketNumber;
            document.querySelector('#manualTicketForm button').innerHTML = '‚úÖ ' + t.registerSale;
            
            // Concern section
            document.querySelector('.concern-section h2').textContent = '‚ö†Ô∏è ' + t.reportConcern;
            document.querySelector('.concern-section p').textContent = t.reportDescription;
            document.querySelector('.concern-section .btn-warning').textContent = t.reportIssue;
            
            // Concern modal
            document.querySelector('.modal-header h3').textContent = t.concernTitle;
            document.querySelectorAll('.form-group label')[0].textContent = t.issueType;
            document.querySelector('#issueType option[value=""]').textContent = t.selectIssue;
            document.querySelector('#issueType option[value="damaged_ticket"]').textContent = t.damagedTicket;
            document.querySelector('#issueType option[value="scanner_issue"]').textContent = t.scannerIssue;
            document.querySelector('#issueType option[value="duplicate_barcode"]').textContent = t.duplicateBarcode;
            document.querySelector('#issueType option[value="customer_complaint"]').textContent = t.customerComplaint;
            document.querySelector('#issueType option[value="other"]').textContent = t.other;
            document.querySelectorAll('.form-group label')[1].textContent = t.ticketNumberOptional;
            document.querySelector('#concernTicketNumber').placeholder = t.optional;
            document.querySelectorAll('.form-group label')[2].textContent = t.description;
            document.querySelector('#concernDescription').placeholder = t.descriptionPlaceholder;
            document.querySelectorAll('.form-actions .btn-cancel')[0].textContent = t.cancel;
            document.querySelector('.form-actions .btn-primary').textContent = t.submitReport;
            
            // Update language selector
            document.getElementById('languageSelector').value = currentLanguage;
        }

        // Check authentication
        async function checkAuth() {
            try {
                const response = await fetch('/api/session-check');
                const data = await response.json();
                
                // Check if user is logged in and user object exists
                if (!data.hasUser || !data.user) {
                    window.location.href = '/';
                    return;
                }
                
                // CHECK ROLE: If admin, redirect to admin page
                if (data.user.role === 'admin') {
                    window.location.href = '/admin';
                    return;
                }
                
                // CHECK ROLE: If not a seller, redirect to login
                if (data.user.role !== 'seller') {
                    window.location.href = '/';
                    return;
                }
                
                // User is a seller - proceed
                currentSeller = data.user;
                document.getElementById('sellerName').textContent = currentSeller.name;
                await loadStats();
                
                // Apply translations after loading user
                applyTranslations();
            } catch (error) {
                console.error('Auth check error:', error);
                window.location.href = '/';
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('ticketsSold').textContent = data.totalTickets || 0;
                document.getElementById('totalRevenue').textContent = (data.totalRevenue || 0).toFixed(2);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Barcode Scanner Functions
        let html5QrCode = null;

        async function openBarcodeScanner() {
            try {
                const container = document.getElementById('scannerContainer');
                const video = document.getElementById('scannerVideo');
                
                // Hide video element, show scanner container
                video.style.display = 'none';
                container.style.display = 'block';
                
                // Create a div for the scanner
                const scannerDiv = document.createElement('div');
                scannerDiv.id = 'seller-scanner-reader';
                scannerDiv.style.width = '100%';
                container.insertBefore(scannerDiv, container.firstChild);
                
                // Initialize html5-qrcode scanner
                html5QrCode = new Html5Qrcode("seller-scanner-reader");
                
                const config = {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    aspectRatio: 1.0
                };
                
                // Start scanning
                await html5QrCode.start(
                    { facingMode: "environment" }, // Use back camera
                    config,
                    async (decodedText, decodedResult) => {
                        // Success - barcode detected
                        console.log(`Barcode detected: ${decodedText}`);
                        
                        // Stop scanner
                        await stopBarcodeScanner();
                        
                        // Process the scanned ticket
                        await processScannedTicket(decodedText);
                    },
                    (errorMessage) => {
                        // Scanning in progress, errors are normal
                    }
                );
                
            } catch (error) {
                console.error('Camera access error:', error);
                alert(translations[currentLanguage].cameraError);
                closeBarcodeScanner();
            }
        }

        async function stopBarcodeScanner() {
            if (html5QrCode) {
                try {
                    await html5QrCode.stop();
                    // Clear the scanner UI if the method exists
                    if (typeof html5QrCode.clear === 'function') {
                        html5QrCode.clear();
                    }
                    html5QrCode = null;
                } catch (err) {
                    console.error('Error stopping scanner:', err);
                    html5QrCode = null;
                }
            }
        }

        async function closeBarcodeScanner() {
            await stopBarcodeScanner();
            
            const container = document.getElementById('scannerContainer');
            const scannerDiv = document.getElementById('seller-scanner-reader');
            
            if (scannerDiv) {
                scannerDiv.remove();
            }
            
            container.style.display = 'none';
        }

        async function processScannedTicket(barcode) {
            const resultDiv = document.getElementById('scanResult');
            const t = translations[currentLanguage];
            resultDiv.innerHTML = '‚è≥ ' + t.processing;
            resultDiv.style.color = '#666';
            
            try {
                const response = await fetch('/api/tickets/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ barcode: barcode })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to process ticket');
                }
                
                resultDiv.innerHTML = `‚úÖ ${t.ticketNumber} ${barcode} ${t.ticketSoldSuccess}`;
                resultDiv.style.color = 'green';
                
                // Refresh stats
                await loadStats();
            } catch (error) {
                console.error('Scan error:', error);
                resultDiv.innerHTML = `‚ùå ${t.errorPrefix} ${error.message}`;
                resultDiv.style.color = 'red';
            }
        }

        // Concern Reporting Functions
        function openConcernModal() {
            document.getElementById('concernModal').classList.add('active');
        }

        function closeConcernModal() {
            document.getElementById('concernModal').classList.remove('active');
            document.getElementById('concernForm').reset();
        }

        document.getElementById('concernForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const issueType = document.getElementById('issueType').value;
            const ticketNumber = document.getElementById('concernTicketNumber').value;
            const description = document.getElementById('concernDescription').value;
            
            try {
                const response = await fetch('/api/seller-concerns', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        issue_type: issueType,
                        ticket_number: ticketNumber,
                        description: description
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to submit concern');
                }
                
                alert('‚úÖ ' + translations[currentLanguage].concernSuccess);
                closeConcernModal();
            } catch (error) {
                console.error('Error submitting concern:', error);
                const t = translations[currentLanguage];
                alert('‚ùå ' + t.errorPrefix + ' ' + error.message);
            }
        });

        // Manual Ticket Entry
        document.getElementById('manualTicketForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ticketNumber = document.getElementById('manualTicketNumber').value.trim();
            const resultDiv = document.getElementById('manualEntryResult');
            const t = translations[currentLanguage];
            
            if (!ticketNumber) {
                resultDiv.innerHTML = '‚ùå ' + t.enterTicket;
                resultDiv.style.color = 'red';
                resultDiv.style.background = '#fee2e2';
                resultDiv.style.display = 'block';
                return;
            }
            
            resultDiv.innerHTML = '‚è≥ ' + t.processing;
            resultDiv.style.color = '#666';
            resultDiv.style.background = '#f3f4f6';
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch('/api/tickets/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ barcode: ticketNumber })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to register ticket');
                }
                
                resultDiv.innerHTML = `‚úÖ ${t.ticketNumber} ${ticketNumber} ${t.ticketSoldSuccess}`;
                resultDiv.style.color = '#065f46';
                resultDiv.style.background = '#d1fae5';
                
                // Clear form
                document.getElementById('manualTicketNumber').value = '';
                
                // Refresh stats
                await loadStats();
                
                // Clear success message after 5 seconds
                setTimeout(() => {
                    resultDiv.style.display = 'none';
                }, 5000);
                
            } catch (error) {
                console.error('Manual entry error:', error);
                resultDiv.innerHTML = `‚ùå ${t.errorPrefix} ${error.message}`;
                resultDiv.style.color = '#991b1b';
                resultDiv.style.background = '#fee2e2';
            }
        });

        // Logout
        function logout() {
            window.location.href = '/logout';
        }

        // Initialize
        checkAuth();
    </script>
    
    <!-- html5-qrcode library for barcode scanning -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</body>
</html>