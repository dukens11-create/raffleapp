<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Templates - Raffle App</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="/styles/template-upload.css">
  <style>
    .template-list {
      display: grid;
      gap: 20px;
      margin-top: 20px;
    }

    .template-card {
      background: #f8fafc;
      padding: 24px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s;
    }

    .template-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .template-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .template-name {
      font-size: 20px;
      font-weight: 700;
      color: #1e293b;
    }

    .active-badge {
      background: #10b981;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .template-previews {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }

    .preview-box {
      background: white;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    .preview-box h4 {
      font-size: 14px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .preview-box img {
      width: 100%;
      height: auto;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .template-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-activate {
      background: #10b981;
      color: white;
    }

    .btn-activate:hover {
      background: #059669;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      font-size: 20px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .empty-state p {
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .template-previews {
        grid-template-columns: 1fr;
      }

      .template-actions {
        flex-direction: column;
      }

      .template-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left">
        <img src="logo.png" alt="Logo">
        <h1>üìã Manage Ticket Templates</h1>
      </div>
      <div class="nav-links">
        <a href="/admin.html">‚Üê Back to Admin</a>
        <a href="/upload-template.html">‚ûï Upload New Template</a>
      </div>
    </header>

    <div class="card">
      <div class="card-title">Your Custom Templates</div>
      <div class="card-subtitle">
        View, activate, or delete your custom ticket designs. Only one template can be active at a time.
      </div>

      <div id="templateList" class="template-list">
        <!-- Templates will be loaded here -->
      </div>

      <div id="emptyState" class="empty-state" style="display: none;">
        <div class="empty-state-icon">üìÑ</div>
        <h3>No Templates Yet</h3>
        <p>You haven't uploaded any custom ticket templates yet.</p>
        <a href="/upload-template.html" class="btn btn-primary">
          ‚ûï Upload Your First Template
        </a>
      </div>
    </div>
  </div>

  <script>
    async function loadTemplates() {
      try {
        const response = await fetch('/api/admin/templates');
        const { templates } = await response.json();

        const listElement = document.getElementById('templateList');
        const emptyState = document.getElementById('emptyState');

        if (templates.length === 0) {
          listElement.style.display = 'none';
          emptyState.style.display = 'block';
          return;
        }

        listElement.style.display = 'grid';
        emptyState.style.display = 'none';
        listElement.innerHTML = '';

        templates.forEach(template => {
          const card = document.createElement('div');
          card.className = 'template-card';
          
          const isActive = template.is_active === 1 || template.is_active === true;
          const frontImagePath = template.front_image_path.split('/').pop();
          const backImagePath = template.back_image_path.split('/').pop();

          card.innerHTML = `
            <div class="template-header">
              <div class="template-name">${escapeHtml(template.name)}</div>
              ${isActive ? '<span class="active-badge">‚úÖ Active</span>' : ''}
            </div>
            <div class="template-previews">
              <div class="preview-box">
                <h4>Front Side:</h4>
                <img src="/uploads/templates/${frontImagePath}" alt="Front">
              </div>
              <div class="preview-box">
                <h4>Back Side:</h4>
                <img src="/uploads/templates/${backImagePath}" alt="Back">
              </div>
            </div>
            <div class="template-actions">
              ${!isActive ? `
                <button class="btn btn-activate" onclick="activateTemplate(${template.id})">
                  ‚úÖ Set as Active
                </button>
              ` : ''}
              <button class="btn btn-danger" onclick="deleteTemplate(${template.id}, '${escapeHtml(template.name)}')">
                üóëÔ∏è Delete
              </button>
            </div>
          `;
          
          listElement.appendChild(card);
        });
      } catch (error) {
        console.error('Error loading templates:', error);
        alert('Failed to load templates: ' + error.message);
      }
    }

    async function activateTemplate(id) {
      try {
        const response = await fetch(`/api/admin/templates/${id}/activate`, {
          method: 'PUT'
        });

        const data = await response.json();

        if (response.ok) {
          alert('‚úÖ Template activated successfully!');
          loadTemplates(); // Reload to show updated status
        } else {
          alert('‚ùå Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error activating template:', error);
        alert('Failed to activate template: ' + error.message);
      }
    }

    async function deleteTemplate(id, name) {
      if (!confirm(`Are you sure you want to delete the template "${name}"? This action cannot be undone.`)) {
        return;
      }

      try {
        const response = await fetch(`/api/admin/templates/${id}`, {
          method: 'DELETE'
        });

        const data = await response.json();

        if (response.ok) {
          alert('‚úÖ Template deleted successfully!');
          loadTemplates(); // Reload to show updated list
        } else {
          alert('‚ùå Error: ' + data.error);
        }
      } catch (error) {
        console.error('Error deleting template:', error);
        alert('Failed to delete template: ' + error.message);
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load templates on page load
    loadTemplates();
  </script>
</body>
</html>
